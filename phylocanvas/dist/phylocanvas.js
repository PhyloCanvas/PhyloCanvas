!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Phylocanvas=t():e.Phylocanvas=t()}(window,(function(){return function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=3)}([function(e,t,r){e.exports=r(1),e.exports.parse_nhx=r(2)},function(e,t){e.exports.parse_newick=function(e){for(var t=[],r={},a=e.split(/\s*(;|\(|\)|,|:)\s*/),n=0;n<a.length;n++){var o=a[n];switch(o){case"(":var i={};r.children=[i],t.push(r),r=i;break;case",":i={};t[t.length-1].children.push(i),r=i;break;case")":r=t.pop();break;case":":break;default:var l=a[n-1];")"==l||"("==l||","==l?r.name=o:":"==l&&(r.branch_length=parseFloat(o))}}return r},e.exports.parse_json=function(e){return function e(t){var r="";if(t.hasOwnProperty("children")){var a=[];t.children.forEach((function(t){var r=e(t);a.push(r)}));var n=a.join();t.hasOwnProperty("name")&&(r="("+n+")"+t.name),t.hasOwnProperty("branch_length")&&(r=r+":"+t.branch_length)}else{var o="";t.hasOwnProperty("name")&&(o=t.name),t.hasOwnProperty("branch_length")&&(o=o+":"+t.branch_length),r+=o}return r}(e)+";"}},function(e,t){e.exports=parse_nhx=function(e){for(var t=[],r={},a=e.split(/\s*(;|\(|\)|\[|\]|,|:|=)\s*/),n=0;n<a.length;n++){var o=a[n];switch(o){case"(":var i={};r.children=[i],t.push(r),r=i;break;case",":i={};t[t.length-1].children.push(i),r=i;break;case")":r=t.pop();break;case":":break;default:var l=a[n-1];if(")"==l||"("==l||","==l)r.name=o;else if(":"==l){isNaN(o)||(r.branch_length=parseFloat(o))}else if("="==l){switch(a[n-2]){case"D":r.duplication=o;break;case"G":r.gene_id=o;break;case"T":r.taxon_id=o}}else;}}return r}},function(e,t,r){"use strict";r.r(t);var a={};r.r(a),r.d(a,"Angles",(function(){return n})),r.d(a,"TreeTypes",(function(){return o})),r.d(a,"EmptyArray",(function(){return i}));var n={Degrees0:0,Degrees45:.25*Math.PI,Degrees90:.5*Math.PI,Degrees180:Math.PI,Degrees270:1.5*Math.PI,Degrees360:2*Math.PI},o={Radial:"rd",Rectangular:"rc",Circular:"cr",Diagonal:"dg",Hierarchical:"hr"},i=[],l={alignLabels:!1,branchScale:null,collapsedIds:i,fillStyle:"#222",fontFamily:"serif",fontSize:16,fontWeight:"normal",haloRadius:12,haloStyle:"#3C7383",haloWidth:4,highlightedId:null,highlightedStyle:"#3C7383",internalNodeStyle:{shape:"none"},labelThreshold:8,leafNodeStyle:{shape:"circle"},lineWidth:1,nodeSize:14,nodesPowRatio:.5,padding:32,renderInternalLabels:!1,renderLabels:!0,renderLeafLabels:!0,rootId:null,rotatedIds:i,selectableInternalNodes:!0,selectableLeafNodes:!0,selectedIds:i,showLabels:!1,showNodes:!0,stepScale:8,strokeStyle:"#222",styleLeafLabels:!1,styleNodeLines:!1,styles:{},type:o.Rectangular,zoomFactor:3};function s(e,t){var r=this[e];this[e]=function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];return t.call(this,r.bind(this),a)}}var c=function(e,t){var r=!0,a=!1,n=void 0;try{for(var o,i=t[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var l=o.value;if("function"!=typeof l)throw new Error("Invalid plugin provided.");l.call(e,e,s.bind(e),l.options)}}catch(e){a=!0,n=e}finally{try{r||null==i.return||i.return()}finally{if(a)throw n}}},d=function(e,t,r){var a=e.state.zoomFactor;return 0===r?t:Math.pow(10,Math.log(t)/Math.log(10)+r*a*.01)},f=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(r){var a=e.indexOf(t);if(-1===a)return e.concat(t);var n=e.concat();return n.splice(a,1),n}return[t]};var u={rd:{alignableLabels:!1,branchScalingAxis:"xy",drawLine:function(e,t,r){e.ctx.beginPath(),e.ctx.moveTo(r.x,r.y),e.ctx.lineTo(r.parent.x,r.parent.y),e.ctx.stroke(),e.ctx.closePath()},getBranchScale:function(e){var t=function(e){return Math.min(e.ctx.canvas.width,e.ctx.canvas.height)}(e)/2,r=e.getVirtualTree(),a=r.rootNode.totalLeafLength-r.rootNode.branchLength;return a>0?t/a:a<0?t*a:0},getNodeAtPoint:function(e,t,r,a){for(var n=e.layout(),o=n.rootNode,i=n.postorderTraversal,l=o.postIndex-o.totalNodes+1;l<=o.postIndex;l++){var s=i[l];if(s.parent&&(s.x>s.parent.x?t<s.x&&t>s.parent.x:t<s.parent.x&&t>s.x))if(isNaN(s.slope)){if(s.y>s.parent.y?r<s.y&&r>s.parent.y:r<s.parent.y&&r>s.y)return s}else if(r>s.slope*t+s.intercept-a&&r<s.slope*t+s.intercept+a)return s}return null},layoutNodes:function(e,t){for(var r=0,a=t.rootNode,o=a.postIndex-a.totalNodes+1;o<=a.postIndex;o++){var i=t.postorderTraversal[o];if(i.isLeaf)i.angle=r*(n.Degrees360/a.visibleLeaves);else{var l=0,s=!0,c=!1,d=void 0;try{for(var f,u=i.children[Symbol.iterator]();!(s=(f=u.next()).done);s=!0){var h=f.value;l+=h.angle*h.totalLeaves}}catch(e){c=!0,d=e}finally{try{s||null==u.return||u.return()}finally{if(c)throw d}}i.angle=l/i.totalLeaves}(i.isLeaf&&!i.isHidden||i.isCollapsed&&!i.isHidden)&&(r+=1)}for(var p=a.preIndex;p<a.preIndex+a.totalNodes;p++){var v=t.preorderTraversal[p],y=v.branchLength*e.state.branchScale;v.x=(v!==a?v.parent.x:0)+y*Math.cos(v.angle),v.y=(v!==a?v.parent.y:0)+y*Math.sin(v.angle),v!==a&&(v.slope=(v.parent.y-v.y)/(v.parent.x-v.x),v.intercept=v.y-v.slope*v.x)}}},rc:{alignableLabels:!0,branchScalingAxis:"x",drawLine:function(e,t,r){r!==t.rootNode&&(e.ctx.beginPath(),e.ctx.moveTo(r.x,r.y),e.ctx.lineTo(r.parent.x,r.y),e.ctx.lineTo(r.parent.x,r.parent.y),e.ctx.stroke(),e.ctx.closePath())},getBranchScale:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.state.stepScale,r=e.getVirtualTree(),a=r.rootNode.totalLeaves*t,n=e.ctx.canvas.width/e.ctx.canvas.height*a,o=r.rootNode.totalLeafLength-r.rootNode.branchLength;return 0===o&&e.error(501),n/o},getNodeAtPoint:function(e,t,r,a){for(var n=e.layout(),o=n.rootNode,i=n.postorderTraversal,l=o.postIndex-o.totalNodes+1;l<=o.postIndex;l++){var s=i[l];if(s.parent&&(t<s.x+a&&t>s.parent.x-a&&r<s.y+a&&r>s.y-a||t<s.parent.x+a&&t>s.parent.x-a&&(r<s.parent.y?r>s.y-a:r<s.y+a)))return s}return null},mainAxis:"x",layoutNodes:function(e,t){for(var r=0,a=t.rootNode,o=a.postIndex-a.totalNodes+1;o<=a.postIndex;o++){var i=t.postorderTraversal[o];if(i.angle=n.Degrees0,i.x=i.distanceFromRoot*e.state.branchScale,i.isLeaf)i.y=r*e.state.stepScale;else if(i.isCollapsed)i.y=r*e.state.stepScale;else{var l=i.children[0].y,s=i.children[i.children.length-1].y;i.y=(s+l)/2}(i.isLeaf&&!i.isHidden||i.isCollapsed&&!i.isHidden)&&(r+=1)}},stepScalingAxis:"y"},cr:{alignableLabels:!0,branchScalingAxis:"xy",drawLine:function(e,t,r){var a=t.rootNode,n=r.parent.distanceFromRoot-a.distanceFromRoot;if(e.ctx.beginPath(),e.ctx.moveTo(r.x,r.y),e.ctx.lineTo(n*e.state.branchScale*Math.cos(r.angle),n*e.state.branchScale*Math.sin(r.angle)),e.ctx.stroke(),e.ctx.closePath(),r.children&&r.children.length&&!r.isCollapsed){var o=r.children[0].angle,i=r.children[r.children.length-1].angle,l=Math.abs(r.distanceFromRoot-a.distanceFromRoot);e.ctx.beginPath(),e.ctx.arc(0,0,l*e.state.branchScale,o,i,i<o),e.ctx.stroke(),e.ctx.closePath()}},getBranchScale:function(e){var t=function(e){return Math.min(e.ctx.canvas.width,e.ctx.canvas.height)}(e)/2,r=e.getVirtualTree().rootNode;return r.totalLeafLength>0?t/r.totalLeafLength:r.totalLeafLength<0?t*r.totalLeafLength:0},getNodeAtPoint:function(e,t,r,a){for(var n=e.layout(),o=n.rootNode,i=n.postorderTraversal,l=o.postIndex-o.totalNodes+1;l<=o.postIndex;l++){var s=i[l];if(s.parent){var c=s.parent.distanceFromRoot-o.distanceFromRoot,d=c*e.state.branchScale*Math.cos(s.angle);if(s.x>d?t<s.x&&t>d:t<d&&t>s.x)if(isNaN(s.slope)){var f=c*e.state.branchScale*Math.sin(s.angle);if(s.y>f?r<s.y&&r>f:r<f&&r>s.y)return s}else if(r>s.slope*t+s.intercept-a&&r<s.slope*t+s.intercept+a)return s}}return null},layoutNodes:function(e,t){for(var r=0,a=t.rootNode,o=a.postIndex-a.totalNodes+1;o<=a.postIndex;o++){var i=t.postorderTraversal[o];if(i.isLeaf)i.angle=r*(n.Degrees360/t.rootNode.visibleLeaves);else{var l=i.children[0].angle,s=i.children[i.children.length-1].angle;i.angle=(s+l)/2}var c=(i.distanceFromRoot-t.rootNode.distanceFromRoot)*e.state.branchScale;i.x=c*Math.cos(i.angle),i.y=c*Math.sin(i.angle),(i.isLeaf&&!i.isHidden||i.isCollapsed&&!i.isHidden)&&(r+=1),i.parent&&(i.slope=Math.tan(i.angle),i.intercept=i.y-i.slope*i.x)}}},dg:{alignableLabels:!1,getBranchScale:function(e){var t=e.getVirtualTree().rootNode,r=e.ctx.canvas.width-2*e.state.padding;return t.totalLeafLength>0?r/t.totalLeafLength:t.totalLeafLength<0?r*t.totalLeafLength:0},getNodeAtPoint:function(e,t,r,a){for(var n=e.getVirtualTree(),o=n.rootNode,i=n.postorderTraversal,l=o.postIndex-o.totalNodes+1;l<=o.postIndex;l++){var s=i[l];if(s&&s.parent&&t<s.x&&t>s.parent.x&&r>s.slope*t+s.intercept-a&&r<s.slope*t+s.intercept+a)return s}return null},drawLine:function(e,t,r){r!==t.rootNode&&(e.ctx.beginPath(),e.ctx.moveTo(r.x,r.y),e.ctx.lineTo(r.parent.x,r.parent.y),e.ctx.stroke(),e.ctx.closePath())},layoutNodes:function(e,t){for(var r=0,a=t.rootNode,o=a.postIndex-a.totalNodes+1;o<=a.postIndex;o++){var i=t.postorderTraversal[o];if(i.angle=n.Degrees0,i.x=(t.rootNode.visibleLeaves-i.visibleLeaves)*e.state.stepScale/2,i.isLeaf)i.y=r*e.state.stepScale;else if(i.isCollapsed)i.y=r*e.state.stepScale;else{var l=i.children[0].y,s=(i.visibleLeaves-i.children[0].visibleLeaves)*e.state.stepScale;i.y=l+s/2}i.isLeaf&&r++}for(var c=a.preIndex;c<a.preIndex+a.totalNodes;c++){var d=t.preorderTraversal[c];d.parent&&(d.slope=(d.parent.y-d.y)/(d.parent.x-d.x),d.intercept=d.y-d.slope*d.x)}},mainAxis:"x",stepScalingAxis:"y"},hr:{alignableLabels:!0,drawLine:function(e,t,r){r!==t.rootNode&&(e.ctx.beginPath(),e.ctx.moveTo(r.x,r.y),e.ctx.lineTo(r.x,r.parent.y),e.ctx.lineTo(r.parent.x,r.parent.y),e.ctx.stroke(),e.ctx.closePath())},branchScalingAxis:"y",getBranchScale:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.state.stepScale,r=e.getVirtualTree(),a=r.rootNode.totalLeaves*t,n=e.ctx.canvas.height/e.ctx.canvas.width*a,o=r.rootNode.totalLeafLength-r.rootNode.branchLength;return 0===o&&e.error(501),n/o},getNodeAtPoint:function(e,t,r,a){for(var n=e.layout(),o=n.rootNode,i=n.preorderTraversal,l=o.preIndex;l<o.preIndex+o.totalNodes;l++){var s=i[l];if(s.parent&&(t<s.x+a&&t>s.x-a&&r<s.y+a&&r>s.parent.y-a||r<s.parent.y+a&&r>s.parent.y-a&&(t<s.parent.x?t>s.x-a:t<s.x+a)))return s}return null},mainAxis:"y",layoutNodes:function(e,t){for(var r=0,a=t.rootNode,o=a.postIndex-a.totalNodes+1;o<=a.postIndex;o++){var i=t.postorderTraversal[o];if(i.angle=n.Degrees90,i.y=i.distanceFromRoot*e.state.branchScale,i.isLeaf)i.x=-1*r*e.state.stepScale;else if(i.isCollapsed)i.x=r*e.state.stepScale;else{var l=i.children[0].x,s=i.children[i.children.length-1].x;i.x=(s+l)/2}(i.isLeaf&&!i.isHidden||i.isCollapsed&&!i.isHidden)&&(r+=1)}},stepScalingAxis:"x"}},h=function(e){return{minScale:e/2,maxScale:Math.max(e,16)}},p=function(e){var t=e.getBounds(!1),r=e.getDrawingArea(),a=t.maxX-t.minX,n=t.maxY-t.minY,o=Math.max(.333*r.width,r.right-r.left-e.state.nodeSize),i=Math.max(.333*r.height,r.bottom-r.top-e.state.nodeSize),l=o/a,s=i/n,c=Math.min(l,s),d=e.state.padding+Math.max(e.state.nodeSize,e.state.fontSize)/2,f=-1*t.minX*c,p=-1*t.minY*c;l>s?(f+=d+(o-a*c)/2,p+=d):l<s?(f+=d,p+=d+(i-n*c)/2):(f+=d,p+=d),void 0===u[e.state.type].mainAxis&&(f+=(r.width-o)/2-d,p+=(r.height-i)/2-d);var v=h(c);return{offsetX:f,offsetY:p,scale:c,minScale:v.minScale,maxScale:v.maxScale}},v=function(e,t,r){var a=f(e.state.collapsedIds,t);return e.chain((function(){return{collapsedIds:a}}),r?p:null)},y=function(e,t){return t/e.state.scale},g={},x=function(e){e.setState(p(e))};function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function S(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function L(e){for(var t=[],r=[e];r.length;){var a=r.shift();t.push(a),Array.isArray(a.children)&&r.unshift.apply(r,m(a.children))}return t}function I(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function N(e){for(var t=[],r=[e];r.length;){var a=r.pop();Array.isArray(a.children)&&r.push.apply(r,I(a.children)),t.push(a)}return t.reverse()}function w(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var P=r(0),O=function(e){var t=e;"string"==typeof e&&(t={type:"newick",data:e});var r=t,a=r.type,n=r.data,o=w(r,["type","data"]),i=null;if("newick"===a||void 0===a)i=P.parse_newick(n);else{if("biojs"!==a)throw new Error("Source type is not supported: ".concat(a));i=n}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.trimQuotes,a=void 0===r||r,n=N(e),o=L(e),i=n.every((function(e){return 0===(e.branchLength||e.branch_length||0)}));if(i){e.branchLength=0;for(var l=0;l<o.length;l++){var s=o[l];if(s.children){var c=!0,d=!1,f=void 0;try{for(var u,h=s.children[Symbol.iterator]();!(c=(u=h.next()).done);c=!0){var p=u.value;p.branchLength=s.branchLength+1}}catch(e){d=!0,f=e}finally{try{c||null==h.return||h.return()}finally{if(d)throw f}}}}}for(var v=0;v<n.length;v++){var y=n[v];if(y.postIndex=v,y.isLeaf=!Array.isArray(y.children),y.branchLength=Math.abs(y.branchLength||y.branch_length||0),delete y.branch_length,y.isLeaf&&"string"==typeof y.name&&(y.id=a?y.name.trim().replace(/^['"]|['"]$/g,""):y.name,delete y.name),y.totalNodes=1,y.totalLeaves=1,y.totalLeafLength=y.branchLength,!y.isLeaf){y.totalNodes=1,y.totalLeaves=0;var g=0,x=!0,b=!1,S=void 0;try{for(var m,I=y.children[Symbol.iterator]();!(x=(m=I.next()).done);x=!0){var w=m.value;y.totalNodes+=w.totalNodes,y.totalLeaves+=w.totalLeaves,w.totalLeafLength>g&&(g=w.totalLeafLength),w.parent=y}}catch(e){b=!0,S=e}finally{try{x||null==I.return||I.return()}finally{if(b)throw S}}y.totalLeafLength=y.branchLength+g,y.longestLeaf=g}}for(var P={},O=[],T=0;T<o.length;T++){var j=o[T];j.preIndex=T,j.id||(j.id=T.toString()),P[j.id]=j,j.distanceFromRoot=(j.parent?j.parent.distanceFromRoot:0)+j.branchLength,j.isLeaf&&O.push(j),j.visibleLeaves=j.totalLeaves}return{nodeById:P,rootNode:e,leafNodes:O,postorderTraversal:n,preorderTraversal:o}}(i,o)};function T(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||1;return(window.devicePixelRatio||1)/t}function j(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function A(e,t,r){var a=[],n=!0,o=!1,i=void 0;try{for(var l,s=r.children[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var c=l.value,d=e.splice(t,c.totalNodes);a.push(d)}}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}for(var f=0,u=a;f<u.length;f++){var h=u[f];e.splice.apply(e,[t,0].concat(j(h)))}}var k=function(e,t,r){var a=t.preorderTraversal,n=t.postorderTraversal;A(a,a.indexOf(r)+1,r);for(var o=0;o<a.length;o++)a[o].preIndex=o;A(n,n.indexOf(r)-r.totalNodes+1,r);for(var i=0;i<n.length;i++)n[i].postIndex=i;r.children.reverse()};function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function M(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function R(e){var t=N(e),r=[],a=!0,n=!1,o=void 0;try{for(var i,l=t[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var s=i.value;if(s.isLeaf)r.push("".concat(s.id,":").concat(s.branchLength));else if(s!==e){var c=r.splice(r.length-s.children.length,s.children.length);r.push("(".concat(c.join(","),"):").concat(s.branchLength))}}}catch(e){n=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(n)throw o}}return"(".concat(r.join(","),");")}var D=function(e){return{branchScale:u[e.state.type].getBranchScale(e,l.stepScale)}},z=function(e){return{stepScale:l.stepScale}},B=function(e){return e.chain(z,D,p)},C=function(e){return{collapsedIds:i}},F=function(e,t,r){return e.pixelRatio=T(e.ctx),{size:{width:t,height:r}}},W=function(e,t,r){var a=f(e.state.rotatedIds,t);return e.chain((function(){return{rotatedIds:a}}),r?p:null)},E=function(e){return{minScale:p(e).minScale}},X=function(e,t,r){var a=r.x,n=r.y,o=e.state.offsetX,i=e.state.offsetY;if(r){var l=u[e.state.type].branchScalingAxis,s=t/e.state.branchScale;if("x"===l||"xy"===l){var c=e.state.offsetX;o=c+(a-((a-c)*s+c))}if("y"===l||"xy"===l){var d=e.state.offsetY;i=d+(n-((n-d)*s+d))}}return e.chain((function(){return{branchScale:t,offsetX:o,offsetY:i}}),E)};function Y(e){return(Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var V=function(e){return{rootId:l.rootId}},G=function(e){return{rotatedIds:i}},q=function(e,t,r){var a=r.x,n=r.y,o=e.state.offsetX,i=e.state.offsetY,l=t/e.state.stepScale;if(r){var s=u[e.state.type].stepScalingAxis;if("x"===s||"xy"===s){var c=e.state.offsetX;o=c+(a-((a-c)*l+c))}if("y"===s||"xy"===s){var d=e.state.offsetY;i=d+(n-((n-d)*l+d))}}return e.chain((function(){return{stepScale:t,offsetX:o,offsetY:i}}),E)};function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var U=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4?arguments[4]:void 0,o=n.x,i=n.y,l=e.state.offsetX+t,s=e.state.offsetY+r;if(0===a)return{offsetX:l,offsetY:s};var c=d(e,e.state.scale,a),f=e.state.scale;return{offsetX:-1*((-1*l+o)/f*c-o),offsetY:-1*((-1*s+i)/f*c-i),scale:c}},$={cache:function(e,t){return e._.cache[t]||(e._.cache[t]=new Map)},chain:function(e){for(var t={},r=arguments.length,a=new Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];for(var o=0,i=a;o<i.length;o++){var l=i[o];if("function"==typeof l){var s=l(e);Object.assign(t,s),Object.assign(e.state,s)}}return t},changeBranchScale:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getCentrePoint();e.setBranchScale(d(e,e.state.branchScale,t),r)},changeScale:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getCentrePoint();e.transform(0,0,t,r)},changeStepScale:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getCentrePoint();e.setStepScale(d(e,e.state.stepScale,t),r)},collapseNode:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.refit,n=void 0!==a&&a,o=e.getNodeById(t);o&&e.setState(v(e,o.id,n))},destroy:function(e){},drawHighlight:function(e,t){var r=e.ctx,a=e.state,o=e._,i=o.actualNodeSize,s=o.actualHaloWidth;r.lineWidth=s,r.strokeWidth=s,r.strokeStyle=a.haloStyle;var c=i/2,d=y(e,l.nodeSize/2),f=t.isLeaf?a.leafNodeStyle:a.internalNodeStyle,u=(a.styles[t.id]||f).shape,h="none"===(void 0===u?f.shape:u)?1.5*s:c+d+Math.floor(c/d/2);r.beginPath(),r.arc(t.x,t.y,h,0,n.Degrees360,!1),r.closePath(),r.stroke()},drawNode:function(e,t,r){var a=e.ctx,o=e.state;a.translate(r.x,r.y),a.rotate(r.angle);var i=(o.styles?o.styles[r.id]:void 0)||g,l=r.isLeaf?o.leafNodeStyle:o.internalNodeStyle;a.fillStyle=i.fillStyle||o.fillStyle||l.fillStyle,a.strokeStyle=e.state.strokeStyle;var s=e._.actualNodeSize,c=e._.actualNodeSize/2;if(e._.renderShapes){var d=(i?i.shape:void 0)||l.shape;e.drawNodeShape(r,d,s)}if((e.state.showLabels||e._.renderLabels)&&(r.isLeaf&&o.renderLeafLabels||!r.isLeaf&&o.renderInternalLabels)){var f=r.isLeaf&&o.alignLabels&&!1!==u[o.type].alignableLabels?o.branchScale*(t.rootNode.longestLeaf-r.distanceFromRoot):0;if(f>0&&e.state.lineWidth*e.state.scale>1){var h=e.ctx.lineWidth;e.ctx.lineWidth=e.ctx.lineWidth/4,e.ctx.strokeWidth=e.ctx.lineWidth,a.beginPath(),a.moveTo(c,0),a.lineTo(c+f,0),a.stroke(),a.closePath(),e.ctx.lineWidth=h,e.ctx.strokeWidth=e.ctx.lineWidth}var p=(r.isLeaf?2:0)*c+f,v=r.angle>n.Degrees90&&r.angle<n.Degrees270;v&&a.rotate(n.Degrees180),a.textAlign=v?"right":"left";var y=a.font;i.fontStyle&&(a.font="".concat(i.fontStyle," ").concat(e._.actualFontSize,"px ").concat(e.state.fontFamily)),!1===o.styleLeafLabels&&(a.fillStyle=i.labelFillStyle||o.fillStyle||l.fillStyle),a.fillText(e.getLabel(r),v?-p:p,0),a.font=y,v&&a.rotate(-n.Degrees180)}a.rotate(-r.angle),a.translate(-r.x,-r.y)},drawNodeShape:function(e,t,r,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:a/2,i=e.ctx;if(i.beginPath(),"dot"===r)i.arc(0,0,2*i.lineWidth,n.Degrees0,n.Degrees360);else if("circle"===r)i.arc(0,0,o,n.Degrees0,n.Degrees360);else if("square"===r)i.rect(-o,-o,a,a);else if("triangle"===r)i.moveTo(0,-o),i.lineTo(o,o),i.lineTo(-o,o),i.lineTo(0,-o);else if("star"===r){var l=Math.PI/5,s=Math.PI/2*3;i.moveTo(0,-o);for(var c=0;c<5;c++)i.lineTo(Math.cos(s)*o,Math.sin(s)*o),s+=l,i.lineTo(Math.cos(s)*o*.5,Math.sin(s)*o*.5),s+=l;i.lineTo(0,-o)}i.fill(),i.stroke(),i.closePath()},exportPNG:function(e){return e.ctx.canvas.toDataURL()},fitInPanel:x,getBounds:function(e){for(var t=e.state,r=e.layout(),a=Number.MAX_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,l=Number.MIN_SAFE_INTEGER,s=t.type===o.Circular&&t.alignLabels,c=r.rootNode,d=c.preIndex;d<c.preIndex+c.totalNodes;d++){var f=r.preorderTraversal[d],u=f.x,h=f.x,p=f.y,v=f.y;if(f.isLeaf){var y=0;s&&(y+=t.branchScale*(r.rootNode.totalLeafLength-f.distanceFromRoot)),h+=y*Math.cos(f.angle),v+=y*Math.sin(f.angle)}u<a&&(a=u),h<a&&(a=h),u>i&&(i=u),h>i&&(i=h),p<n&&(n=p),v<n&&(n=v),p>l&&(l=p),v>l&&(l=v),f.isCollapsed&&(d+=f.totalNodes-1)}return{minX:a,maxX:i,minY:n,maxY:l}},getCentrePoint:function(e){return{x:e.ctx.canvas.width/2/e.pixelRatio,y:e.ctx.canvas.height/2/e.pixelRatio}},getDrawingArea:function(e){var t=e.state.size.width,r=e.state.size.height,a=e.state.padding;return{width:t,height:r,left:a,top:a,right:t-a,bottom:r-a}},getInitialState:function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){S(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},l,{},t)},getLabel:function(e,t){var r=e.state.styles;return t.id in r&&r[t.id].label||t.label||t.id},getLeafIds:function(e,t){for(var r=e.getVirtualTree(),a=e.getNodeById(t||r.rootNode),n=[],o=a.preIndex;o<a.preIndex+a.totalNodes;o++)r.preorderTraversal[o].isLeaf&&n.push(r.preorderTraversal[o].id);return n},getLeafLabels:function(e,t){for(var r=e.getVirtualTree(),a=e.getNodeById(t||r.rootNode),n=[],o=a.preIndex;o<a.preIndex+a.totalNodes;o++){var i=r.preorderTraversal[o];i.isLeaf&&n.push(e.getLabel(i))}return n},getNewick:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.layout(),n=t?e.getNodeById(t):a.rootNode,o=r.excludeCollapsed,i=void 0===o||o,l=[],s=n.postIndex-n.totalNodes+1;s<n.postIndex;s++){var c=a.postorderTraversal[s];if(c.isLeaf)l.push("".concat(e.getLabel(c),":").concat(c.branchLength));else{var d=l.splice(l.length-c.children.length,c.children.length);i&&c.isCollapsed?l.push("[".concat(c.totalLeaves," hidden ").concat(1===c.totalLeaves?"leaf":"leaves","]:").concat(c.branchLength)):l.push("(".concat(d.join(","),"):").concat(c.branchLength))}}return"(".concat(l.join(","),");")},getNodeAtPoint:function(e,t,r){for(var a=e._.actualNodeSize/2+y(e,3),n=e.layout(),o=n.rootNode,i=o.preIndex;i<o.preIndex+o.totalNodes;i++){var l=n.preorderTraversal[i];if(!l.isHidden&&t>l.x-a&&t<l.x+a&&r>l.y-a&&r<l.y+a)return l}var s=u[e.state.type];return s.getNodeAtPoint?s.getNodeAtPoint(e,t,r,a):null},getNodeById:function(e,t){var r=e.getVirtualTree();if("string"==typeof t){var a=r.nodeById[t];return a||e.error("Cannot find node of ID=",t),a}var n=r.nodeById[t.id];return n&&n===t||e.error("Node not found",t),n},getNodeLabels:function(e,t){var r=[],a=!0,n=!1,o=void 0;try{for(var i,l=t[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var s=i.value,c=e.getNodeById(s);c&&c.isLeaf&&r.push(e.getLabel(c))}}catch(e){n=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(n)throw o}}return r},getVirtualTree:function(e){var t=e.state,r=void 0===t?{}:t,a=e.cache("virtual");if(a.get("source")!==r.source){var n=performance.now(),o=O(r.source),i=o.nodeById,l=o.rootNode,s=o.leafNodes,c=o.postorderTraversal,d=o.preorderTraversal;e.nodes={nodeById:i,rootNode:l,leafNodes:s,postorderTraversal:c,preorderTraversal:d,source:r.source,originalSource:r.source.original||r.source};var f=performance.now();e.log("parsing virtual tree took ",f-n," milliseconds."),e._.cache={},a=e.cache("virtual")}if((a.get("rootId")||null)!==e.state.rootId){var u=e.nodes.nodeById[e.state.rootId]||e.nodes.preorderTraversal[0],h=[];u.distanceFromRoot=0;for(var p=u.preIndex+1;p<u.preIndex+u.totalNodes;p++){var v=e.nodes.preorderTraversal[p];v.distanceFromRoot=v.parent.distanceFromRoot+v.branchLength,v.isLeaf&&h.push(v)}e.nodes.leafNodes=h,e.nodes.rootNode=u}return a.set("source",r.source),a.set("rootId",e.state.rootId),e.nodes},highlightNode:function(e,t){var r="string"==typeof t?e.getNodeById(t):t,a=r&&!r.isHidden?r.id:null;e._.highlightedId!==a&&(e._.highlightedId=a,e.render())},init:function(e,t){e.state=e.getInitialState(t),e.pixelRatio=T(e.ctx)},layout:function(e){var t=e.state,r=e.getVirtualTree(),a=e.cache("layout");if(isNaN(r.maxLabelWidth)||a.get("styles")!==t.styles){var n="",o=!0,i=!1,l=void 0;try{for(var s,c=r.leafNodes[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var d=s.value,f=e.getLabel(d);f.length>n.length&&(n=f)}}catch(e){i=!0,l=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw l}}r.maxLabelWidth=e.measureTextWidth(n)}if(a.get("rotatedIds")!==t.rotatedIds){var h=new Set(t.rotatedIds);if(a.get("rotatedIds")){var p=!0,v=!1,y=void 0;try{for(var g,x=a.get("rotatedIds")[Symbol.iterator]();!(p=(g=x.next()).done);p=!0){var b=g.value,S=r.nodeById[b];h.has(S.id)||(k(0,r,S),S.isInverted=!1)}}catch(e){v=!0,y=e}finally{try{p||null==x.return||x.return()}finally{if(v)throw y}}}var m=!0,L=!1,I=void 0;try{for(var N,w=t.rotatedIds[Symbol.iterator]();!(m=(N=w.next()).done);m=!0){var P=N.value,O=r.nodeById[P];O.isInverted||(k(0,r,O),O.isInverted=!0)}}catch(e){L=!0,I=e}finally{try{m||null==w.return||w.return()}finally{if(L)throw I}}}if(a.get("collapsedIds")!==t.collapsedIds){for(var T=new Set(t.collapsedIds),j=0;j<r.postorderTraversal.length;j++){var A=r.preorderTraversal[j];A.isCollapsed=T.has(A.id),A.parent&&(A.parent.isCollapsed||A.parent.isHidden)?A.isHidden=!0:A.isHidden=!1}for(var _=0;_<r.postorderTraversal.length;_++){var M=r.postorderTraversal[_];if(M.isLeaf)M.visibleLeaves=1;else if(M.isCollapsed)M.visibleLeaves=1;else{M.visibleLeaves=0;var R=!0,D=!1,z=void 0;try{for(var B,C=M.children[Symbol.iterator]();!(R=(B=C.next()).done);R=!0){var F=B.value;M.visibleLeaves+=F.visibleLeaves}}catch(e){D=!0,z=e}finally{try{R||null==C.return||C.return()}finally{if(D)throw z}}}}}if(a.get("branchScale")!==t.branchScale||a.get("collapsedIds")!==t.collapsedIds||a.get("rootId")!==t.rootId||a.get("rotatedIds")!==t.rotatedIds||a.get("stepScale")!==t.stepScale||a.get("type")!==t.type){var W=performance.now();u[t.type].layoutNodes(e,r);var E=performance.now();e.log("layout nodes took ",E-W," milliseconds.")}return a.set("branchScale",t.branchScale),a.set("collapsedIds",t.collapsedIds),a.set("rootId",t.rootId),a.set("rotatedIds",t.rotatedIds),a.set("stepScale",t.stepScale),a.set("type",t.type),a.set("styles",t.styles),r},measureTextWidth:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.state.fontWeight,a=e.ctx.font;e.ctx.font="".concat(r," ").concat(e.state.fontSize,"px ").concat(e.state.fontFamily);var n=e.ctx.measureText(t);return e.ctx.font=a,Math.ceil(n.width+e.state.fontSize)},mergeState:function(e,t){e.state=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){M(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},e.state,{},t)},postRender:function(e,t){for(var r=e.state,a=t.rootNode.preIndex;a<t.rootNode.preIndex+t.rootNode.totalNodes;a++){var n=t.preorderTraversal[a];-1===r.selectedIds.indexOf(n.id)&&n.id!==e._.highlightedId||e.drawHighlight(n),n.isCollapsed&&(a+=n.totalNodes-1)}e.ctx.restore(),e.ctx.canvas.title="",e.ctx.canvas.style&&(e.ctx.canvas.style.cursor=e._.highlightedId?"pointer":"")},preRender:function(e,t){e.ctx.save(),e.ctx.clearRect(0,0,e.ctx.canvas.width,e.ctx.canvas.height),e._.actualMaxLabelWidth=y(e,t.maxLabelWidth),e._.actualFontSize=y(e,e.state.fontSize),e._.actualNodeSize=y(e,e.state.nodeSize),e._.actualHaloRadius=y(e,Math.max(.75*e.state.nodeSize,e.state.haloRadius)),e._.actualHaloWidth=y(e,e.state.haloWidth),e._.renderShapes=e.state.showNodes,e._.renderLabels=e.state.showLabels||e.state.stepScale*e.state.scale>=e.state.labelThreshold,e.ctx.textBaseline="middle",e.ctx.font="".concat(e._.actualFontSize,"px ").concat(e.state.fontFamily),e.ctx.lineWidth=y(e,e.state.lineWidth),e.ctx.strokeWidth=e.ctx.lineWidth,e.ctx.translate(e.state.offsetX*e.pixelRatio,e.state.offsetY*e.pixelRatio),e.ctx.scale(e.state.scale*e.pixelRatio,e.state.scale*e.pixelRatio)},render:function(e){e.resizeCanvas();var t=e.layout(),r=performance.now();if(e.preRender(t),e.state.styleNodeLines){var a=!0,n=!1,o=void 0;try{for(var i,l=t.postorderTraversal[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var s=i.value;if(s.isLeaf){var c=e.state.styles?e.state.styles[s.id]:void 0;s.strokeStyle=(c?c.strokeStyle:void 0)||e.state.strokeStyle}else{s.strokeStyle=s.children[0].strokeStyle;var d=!0,f=!1,h=void 0;try{for(var p,v=s.children[Symbol.iterator]();!(d=(p=v.next()).done);d=!0){if(p.value.strokeStyle!==s.strokeStyle){s.strokeStyle=e.state.strokeStyle;break}}}catch(e){f=!0,h=e}finally{try{d||null==v.return||v.return()}finally{if(f)throw h}}}}}catch(e){n=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(n)throw o}}}for(var y=t.rootNode.preIndex,g=t.rootNode.preIndex+t.rootNode.totalNodes,x=y;x<g;x++){var b=t.preorderTraversal[x];b!==t.rootNode&&(b.id===e._.highlightedId?e.ctx.strokeStyle=e.state.highlightedStyle:e.state.styleNodeLines?e.ctx.strokeStyle=b.strokeStyle:e.ctx.strokeStyle=e.state.strokeStyle,u[e.state.type].drawLine(e,t,b),b.isCollapsed&&(x+=b.totalNodes-1))}for(var S=y;S<g;S++){var m=t.preorderTraversal[S];e.drawNode(t,m),m.isCollapsed&&(S+=m.totalNodes-1)}e.postRender(t);var L=performance.now();e.log("render took ",L-r," milliseconds.")},rerootNode:function(e,t){var r=e.getNodeById(t),a=e.layout();if(r.parent){var n={branchLength:0,children:[]};!function e(t,r,a,n){var o={branchLength:n.branchLength,children:[],parent:a};a.children.push(o);var i=!0,l=!1,s=void 0;try{for(var c,d=n.parent.children[Symbol.iterator]();!(i=(c=d.next()).done);i=!0){var f=c.value;f!==n&&o.children.push(f)}}catch(e){l=!0,s=e}finally{try{i||null==d.return||d.return()}finally{if(l)throw s}}n.parent.parent&&n.parent!==r.rootNode&&e(t,r,o,n.parent)}(e,a,n,r),n.children.push(r);var o={type:"newick",original:e.state.source,data:R(n)};e.setSource(o)}},reset:function(e,t){e.setState(B(e))},resetCollapsedNodes:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.refit,a=void 0!==r&&r;return e.setState(e.chain(C,a?x:null))},resize:function(e,t,r){e.setState(F(e,t,r))},resizeCanvas:function(e){var t=e.state.size,r=t.width,a=t.height;e.ctx.canvas.style&&(e.ctx.canvas.style.width="".concat(r,"px"),e.ctx.canvas.style.height="".concat(a,"px"),e.ctx.canvas.width=r*e.pixelRatio,e.ctx.canvas.height=a*e.pixelRatio)},rotateNode:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r.refit,n=void 0!==a&&a,o=e.getNodeById(t);o&&e.setState(W(e,o.id,n))},selectLeafNodes:function(e,t,r){t&&Array.isArray(t)&&e.setState(function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r){var a=new Set(e.state.selectedIds),n=!0,o=!1,l=void 0;try{for(var s,c=t[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var d=s.value;a.add(d)}}catch(e){o=!0,l=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw l}}return{selectedIds:Array.from(a)}}return{selectedIds:t.length?t:i}}(e,t,r))},selectNode:function(e,t,r){var a=t?e.getNodeById(t):null;if(a&&a.isLeaf)e.setState(function(e,t,r){return{selectedIds:f(e.state.selectedIds,t,r)}}(e,a.id,r));else if(a){var n=a&&!a.isHidden?e.getLeafIds(a):i;e.setState(function(e,t,r){if(r){var a=new Set(e.state.selectedIds),n=!0,o=!1,i=void 0;try{for(var l,s=t[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var c=l.value;a.add(c)}}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return{selectedIds:Array.from(a)}}return{selectedIds:t}}(e,n,r))}else e.setState({selectedIds:i})},setBranchScale:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getCentrePoint(),a=u[e.state.type].branchScalingAxis;a&&t>0&&e.setState(X(e,t,r))},setFontSize:function(e,t){"number"==typeof t?e.setState({fontSize:t}):e.error("Invalid font size value, expected number, got ",Y(t))},setNodeSize:function(e,t){"number"==typeof t?e.setState({nodeSize:t}):e.error("Invalid node size value, expected number, got ",H(t))},setRoot:function(e,t){var r=null;null!==t&&(r=e.getNodeById(t)),e.setState(function(e,t){return e.chain((function(){return{rootId:t}}),B)}(e,r?r.id:null))},setScale:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getCentrePoint();if(!(t<=0)){if(r){var a=t/e.state.scale,n=e.state.offsetX;e.state.offsetX=n+(r.x-((r.x-n)*a+n));var o=e.state.offsetY;e.state.offsetY=o+(r.y-((r.y-o)*a+o))}e.state.scale=t,e.render()}},setSource:function(e,t){e.setState(function(e,t){return e.chain((function(){return{source:t}}),V,C,G,B)}(e,t))},setState:function(e,t){t&&(e.mergeState(t),e.render())},setStepScale:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getCentrePoint(),a=u[e.state.type].stepScalingAxis;a&&t>0&&e.setState(q(e,t,r))},setStyles:function(e,t){"object"===Q(t)?e.setState({styles:t}):e.error("Invalid node styles, expected object, got ",Q(t))},setTreeType:function(e,t){e.setState(function(e,t){return e.chain((function(){return{type:t}}),B)}(e,t))},toggleAlignLeafLabels:function(e){e.setState({alignLabels:!e.state.alignLabels})},toggleLeafLabels:function(e){e.setState({renderLeafLabels:!e.state.renderLeafLabels})},transform:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.getCentrePoint();0===t&&0===r&&0===a||e.setState(U(e,t,r,a,n))},trigger:function(e,t,r){var a=e["on".concat(t)];"function"==typeof a&&a.apply(e,r)}},J=function(e){e.error=console.error,e.log=function(){};for(var t=0,r=Object.keys($);t<r.length;t++){var a=r[t];e[a]=$[a].bind(null,e)}};function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{x:(t-e.state.offsetX)/e.state.scale,y:(r-e.state.offsetY)/e.state.scale}}function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function ee(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var te=function(e,t,r,a){var n=e.startPoint,o=e.centrePoint,i=e.endPoint,l=a-2*t,s=(r-2*t)/(i.x-n.x),c=l/(i.y-n.y),d=Math.min(s,c);return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){ee(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({offsetX:r/2-o.x*d,offsetY:a/2-o.y*d,scale:d},h(d))};function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function ae(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ne=function(e,t,r){var a=e.state.size;if(a.width===t&&a.height===r)return{};var n=function(e){var t=e.getDrawingArea(),r=t.width,a=t.height,n=e.getBounds(),o=n.minX,i=n.maxX,l=n.minY,s=n.maxY,c=K(e,e.state.padding,e.state.padding),d=K(e,r-e.state.padding,a-e.state.padding),f=K(e,r/2,a/2);return{startPoint:{x:Math.max(c.x,o),y:Math.max(c.y,l)},endPoint:{x:Math.min(d.x,i),y:Math.min(d.y,s)},centrePoint:f}}(e);return function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){ae(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},F(e,t,r),{},te(n,e.state.padding,t,r))},oe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a={canvas:e,ctx:e.getContext("2d"),state:{},_:{cache:{}}};if(J(a),r.length&&c(a,r),a.init(t),t.source){var n=a.ctx.canvas,o=n.width,i=n.height;a.setState(a.chain((function(){return a.state.size?ne(a,o,i):F(a,o,i)}),(function(){return{source:t.source}}),(function(){return a.state.rootId?{rootId:a.state.rootId}:V()}),(function(){return a.state.collapsedIds?{collapsedIds:a.state.collapsedIds}:C()}),(function(){return a.state.rotatedIds?{rotatedIds:a.state.rotatedIds}:G()}),(function(){return a.state.stepScale?{stepScale:a.state.stepScale}:z()}),(function(){return a.state.branchScale?{branchScale:a.state.branchScale}:D(a)}),(function(){var e=p(a),t=e.offsetX,r=e.offsetY,n=e.scale,o=e.minScale,i=e.maxScale;return{offsetX:a.state.offsetX||t,offsetY:a.state.offsetY||r,scale:a.state.scale||n,minScale:a.state.minScale||o,maxScale:a.state.maxScale||i}})))}return a};var ie={appendToArray:f,getPixelRatio:T,mapPoint:K,mapScalar:y,restoreViewport:te,unmapPoint:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return{x:t*e.state.scale+e.state.offsetX,y:r*e.state.scale+e.state.offsetY}},unmapScalar:function(e,t){return t*e.state.scale}};r.d(t,"constants",(function(){return a})),r.d(t,"defaults",(function(){return l})),r.d(t,"createTree",(function(){return oe})),r.d(t,"methods",(function(){return $})),r.d(t,"types",(function(){return u})),r.d(t,"utils",(function(){return ie}));t.default={constants:a,defaults:l,createTree:oe,methods:$,types:u,utils:ie}}])}));
//# sourceMappingURL=phylocanvas.js.map