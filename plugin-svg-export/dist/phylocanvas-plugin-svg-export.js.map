{"version":3,"sources":["webpack://PhylocanvasPluginSVGExport/webpack/universalModuleDefinition","webpack://PhylocanvasPluginSVGExport/webpack/bootstrap","webpack://PhylocanvasPluginSVGExport/./node_modules/canvas2svg/canvas2svg.js","webpack://PhylocanvasPluginSVGExport/./index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","STYLES","ctx","CanvasGradient","CanvasPattern","namedEntities","format","str","args","keys","length","replace","RegExp","randomString","holder","chars","randomstring","Error","Math","floor","random","getDominantBaseline","textBaseline","mapping","alphabetic","items","radix","entity","base10","lookup","split","parseInt","createNamedToNumberedLookup","svgAttr","canvas","svg","apply","gradientNode","this","__root","__ctx","addColorStop","offset","color","matches","stop","__createElement","setAttribute","indexOf","exec","g","b","appendChild","pattern","options","defaultOptions","width","height","enableMirroring","arguments","undefined","__document","document","__canvas","createElement","getContext","__setDefaultStyles","__stack","__getStyleState","__groupStack","createElementNS","setAttributeNS","__ids","__defs","__currentElement","elementName","properties","resetFill","element","__applyStyleState","styleState","__applyStyleToCurrentElement","type","style","id","childNodes","getAttribute","__closestGroupOrSvg","node","nodeName","parentNode","getSerializedSvg","fixNamedEntities","regexp","serialized","XMLSerializer","serializeToString","test","getSvg","save","group","parent","push","restore","pop","state","__addTransform","transform","scale","x","y","rotate","angle","degrees","PI","cx","cy","translate","a","e","f","beginPath","path","__currentDefaultPath","__currentPosition","__applyCurrentDefaultPath","__addPathCommand","command","moveTo","closePath","lineTo","bezierCurveTo","cp1x","cp1y","cp2x","cp2y","quadraticCurveTo","cpx","cpy","normalize","vector","len","sqrt","arcTo","x1","y1","x2","y2","radius","x0","y0","unit_vec_p1_p0","unit_vec_p1_p2","cos","theta","acos","abs","unit_vec_p1_origin","len_p1_origin","sin","unit_vec_origin_start_tangent","unit_vec_origin_end_tangent","getAngle","startAngle","endAngle","arc","stroke","fill","rect","fillRect","strokeRect","clearRect","createLinearGradient","grad","createRadialGradient","r0","r1","fx","fy","__parseFont","fontPart","font","data","size","family","weight","decoration","href","__fontUnderline","__fontHref","__wrapTextLink","__applyText","text","action","textAlign","textElement","start","createTextNode","fillText","strokeText","measureText","counterClockwise","endX","endY","startX","startY","sweepFlag","largeArcFlag","diff","rx","ry","xAxisRotation","clip","clipPath","newGroup","removeChild","drawImage","dx","dy","dw","dh","sw","sh","defs","currentElement","svgImage","Array","slice","image","sx","sy","toDataURL","createPattern","repetition","img","drawFocusRing","createImageData","getImageData","putImageData","globalCompositeOperation","setTransform","C2S","exportSVG","tree","method","originalCxt","svgCtx","render","exportSerialisedSVG"],"mappings":"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","file":"phylocanvas-plugin-svg-export.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PhylocanvasPluginSVGExport\"] = factory();\n\telse\n\t\troot[\"PhylocanvasPluginSVGExport\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","/*!!\n *  Canvas 2 Svg v1.0.15\n *  A low level canvas to SVG converter. Uses a mock canvas context to build an SVG document.\n *\n *  Licensed under the MIT license:\n *  http://www.opensource.org/licenses/mit-license.php\n *\n *  Author:\n *  Kerry Liu\n *\n *  Copyright (c) 2014 Gliffy Inc.\n */\n\n;(function() {\n    \"use strict\";\n\n    var STYLES, ctx, CanvasGradient, CanvasPattern, namedEntities;\n\n    //helper function to format a string\n    function format(str, args) {\n        var keys = Object.keys(args), i;\n        for (i=0; i<keys.length; i++) {\n            str = str.replace(new RegExp(\"\\\\{\" + keys[i] + \"\\\\}\", \"gi\"), args[keys[i]]);\n        }\n        return str;\n    }\n\n    //helper function that generates a random string\n    function randomString(holder) {\n        var chars, randomstring, i;\n        if (!holder) {\n            throw new Error(\"cannot create a random attribute name for an undefined object\");\n        }\n        chars = \"ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz\";\n        randomstring = \"\";\n        do {\n            randomstring = \"\";\n            for (i = 0; i < 12; i++) {\n                randomstring += chars[Math.floor(Math.random() * chars.length)];\n            }\n        } while (holder[randomstring]);\n        return randomstring;\n    }\n\n    //helper function to map named to numbered entities\n    function createNamedToNumberedLookup(items, radix) {\n        var i, entity, lookup = {}, base10, base16;\n        items = items.split(',');\n        radix = radix || 10;\n        // Map from named to numbered entities.\n        for (i = 0; i < items.length; i += 2) {\n            entity = '&' + items[i + 1] + ';';\n            base10 = parseInt(items[i], radix);\n            lookup[entity] = '&#'+base10+';';\n        }\n        //FF and IE need to create a regex from hex values ie &nbsp; == \\xa0\n        lookup[\"\\\\xa0\"] = '&#160;';\n        return lookup;\n    }\n\n    //helper function to map canvas-textAlign to svg-textAnchor\n    function getTextAnchor(textAlign) {\n        //TODO: support rtl languages\n        var mapping = {\"left\":\"start\", \"right\":\"end\", \"center\":\"middle\", \"start\":\"start\", \"end\":\"end\"};\n        return mapping[textAlign] || mapping.start;\n    }\n\n    //helper function to map canvas-textBaseline to svg-dominantBaseline\n    function getDominantBaseline(textBaseline) {\n        //INFO: not supported in all browsers\n        var mapping = {\"alphabetic\": \"alphabetic\", \"hanging\": \"hanging\", \"top\":\"text-before-edge\", \"bottom\":\"text-after-edge\", \"middle\":\"central\"};\n        return mapping[textBaseline] || mapping.alphabetic;\n    }\n\n    // Unpack entities lookup where the numbers are in radix 32 to reduce the size\n    // entity mapping courtesy of tinymce\n    namedEntities = createNamedToNumberedLookup(\n        '50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' +\n            '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' +\n            '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' +\n            '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' +\n            '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' +\n            '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' +\n            '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' +\n            '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' +\n            '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' +\n            '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' +\n            'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' +\n            'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' +\n            't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' +\n            'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' +\n            'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' +\n            '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' +\n            '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' +\n            '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' +\n            '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' +\n            '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' +\n            'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' +\n            'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' +\n            'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' +\n            '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' +\n            '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\n\n\n    //Some basic mappings for attributes and default values.\n    STYLES = {\n        \"strokeStyle\":{\n            svgAttr : \"stroke\", //corresponding svg attribute\n            canvas : \"#000000\", //canvas default\n            svg : \"none\",       //svg default\n            apply : \"stroke\"    //apply on stroke() or fill()\n        },\n        \"fillStyle\":{\n            svgAttr : \"fill\",\n            canvas : \"#000000\",\n            svg : null, //svg default is black, but we need to special case this to handle canvas stroke without fill\n            apply : \"fill\"\n        },\n        \"lineCap\":{\n            svgAttr : \"stroke-linecap\",\n            canvas : \"butt\",\n            svg : \"butt\",\n            apply : \"stroke\"\n        },\n        \"lineJoin\":{\n            svgAttr : \"stroke-linejoin\",\n            canvas : \"miter\",\n            svg : \"miter\",\n            apply : \"stroke\"\n        },\n        \"miterLimit\":{\n            svgAttr : \"stroke-miterlimit\",\n            canvas : 10,\n            svg : 4,\n            apply : \"stroke\"\n        },\n        \"lineWidth\":{\n            svgAttr : \"stroke-width\",\n            canvas : 1,\n            svg : 1,\n            apply : \"stroke\"\n        },\n        \"globalAlpha\": {\n            svgAttr : \"opacity\",\n            canvas : 1,\n            svg : 1,\n            apply : \"fill stroke\"\n        },\n        \"font\":{\n            //font converts to multiple svg attributes, there is custom logic for this\n            canvas : \"10px sans-serif\"\n        },\n        \"shadowColor\":{\n            canvas : \"#000000\"\n        },\n        \"shadowOffsetX\":{\n            canvas : 0\n        },\n        \"shadowOffsetY\":{\n            canvas : 0\n        },\n        \"shadowBlur\":{\n            canvas : 0\n        },\n        \"textAlign\":{\n            canvas : \"start\"\n        },\n        \"textBaseline\":{\n            canvas : \"alphabetic\"\n        }\n    };\n\n    /**\n     *\n     * @param gradientNode - reference to the gradient\n     * @constructor\n     */\n    CanvasGradient = function(gradientNode, ctx) {\n        this.__root = gradientNode;\n        this.__ctx = ctx;\n    };\n\n    /**\n     * Adds a color stop to the gradient root\n     */\n    CanvasGradient.prototype.addColorStop = function(offset, color) {\n        var stop = this.__ctx.__createElement(\"stop\"), regex, matches;\n        stop.setAttribute(\"offset\", offset);\n        if(color.indexOf(\"rgba\") !== -1) {\n            //separate alpha value, since webkit can't handle it\n            regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\n            matches = regex.exec(color);\n            stop.setAttribute(\"stop-color\", format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\n            stop.setAttribute(\"stop-opacity\", matches[4]);\n        } else {\n            stop.setAttribute(\"stop-color\", color);\n        }\n        this.__root.appendChild(stop);\n    };\n\n    CanvasPattern = function(pattern, ctx) {\n        this.__root = pattern;\n        this.__ctx = ctx;\n    };\n\n    /**\n     * The mock canvas context\n     * @param o - options include:\n     * width - width of your canvas (defaults to 500)\n     * height - height of your canvas (defaults to 500)\n     * enableMirroring - enables canvas mirroring (get image data) (defaults to false)\n     * document - the document object (defaults to the current document)\n     */\n    ctx = function(o) {\n\n        var defaultOptions = { width:500, height:500, enableMirroring : false}, options;\n\n        //keep support for this way of calling C2S: new C2S(width,height)\n        if(arguments.length > 1) {\n            options = defaultOptions;\n            options.width = arguments[0];\n            options.height = arguments[1];\n        } else if( !o ) {\n            options = defaultOptions;\n        } else {\n            options = o;\n        }\n\n        if(!(this instanceof ctx)) {\n            //did someone call this without new?\n            return new ctx(options);\n        }\n\n        //setup options\n        this.width = options.width || defaultOptions.width;\n        this.height = options.height || defaultOptions.height;\n        this.enableMirroring = options.enableMirroring !== undefined ? options.enableMirroring : defaultOptions.enableMirroring;\n\n        this.canvas = this;   ///point back to this instance!\n        this.__document = options.document || document;\n        this.__canvas = this.__document.createElement(\"canvas\");\n        this.__ctx = this.__canvas.getContext(\"2d\");\n\n        this.__setDefaultStyles();\n        this.__stack = [this.__getStyleState()];\n        this.__groupStack = [];\n\n        //the root svg element\n        this.__root = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\");\n        this.__root.setAttribute(\"version\", 1.1);\n        this.__root.setAttribute(\"xmlns\", \"http://www.w3.org/2000/svg\");\n        this.__root.setAttributeNS(\"http://www.w3.org/2000/xmlns/\", \"xmlns:xlink\", \"http://www.w3.org/1999/xlink\");\n        this.__root.setAttribute(\"width\", this.width);\n        this.__root.setAttribute(\"height\", this.height);\n\n        //make sure we don't generate the same ids in defs\n        this.__ids = {};\n\n        //defs tag\n        this.__defs = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"defs\");\n        this.__root.appendChild(this.__defs);\n\n        //also add a group child. the svg element can't use the transform attribute\n        this.__currentElement = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"g\");\n        this.__root.appendChild(this.__currentElement);\n    };\n\n\n    /**\n     * Creates the specified svg element\n     * @private\n     */\n    ctx.prototype.__createElement = function (elementName, properties, resetFill) {\n        if (typeof properties === \"undefined\") {\n            properties = {};\n        }\n\n        var element = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", elementName),\n            keys = Object.keys(properties), i, key;\n        if(resetFill) {\n            //if fill or stroke is not specified, the svg element should not display. By default SVG's fill is black.\n            element.setAttribute(\"fill\", \"none\");\n            element.setAttribute(\"stroke\", \"none\");\n        }\n        for(i=0; i<keys.length; i++) {\n            key = keys[i];\n            element.setAttribute(key, properties[key]);\n        }\n        return element;\n    };\n\n    /**\n     * Applies default canvas styles to the context\n     * @private\n     */\n    ctx.prototype.__setDefaultStyles = function() {\n        //default 2d canvas context properties see:http://www.w3.org/TR/2dcontext/\n        var keys = Object.keys(STYLES), i, key;\n        for(i=0; i<keys.length; i++) {\n            key = keys[i];\n            this[key] = STYLES[key].canvas;\n        }\n    };\n\n    /**\n     * Applies styles on restore\n     * @param styleState\n     * @private\n     */\n    ctx.prototype.__applyStyleState = function(styleState) {\n        var keys = Object.keys(styleState), i, key;\n        for(i=0; i<keys.length; i++) {\n            key = keys[i];\n            this[key] = styleState[key];\n        }\n    };\n\n    /**\n     * Gets the current style state\n     * @return {Object}\n     * @private\n     */\n    ctx.prototype.__getStyleState = function() {\n        var i, styleState = {}, keys = Object.keys(STYLES), key;\n        for(i=0; i<keys.length; i++) {\n            key = keys[i];\n            styleState[key] = this[key];\n        }\n        return styleState;\n    };\n\n    /**\n     * Apples the current styles to the current SVG element. On \"ctx.fill\" or \"ctx.stroke\"\n     * @param type\n     * @private\n     */\n    ctx.prototype.__applyStyleToCurrentElement = function(type) {\n        var keys = Object.keys(STYLES), i, style, value, id, regex, matches;\n        for(i=0; i<keys.length; i++) {\n            style = STYLES[keys[i]];\n            value = this[keys[i]];\n            if(style.apply) {\n                //is this a gradient or pattern?\n                if(style.apply.indexOf(\"fill\")!==-1 && value instanceof CanvasPattern) {\n                    //pattern\n                    if(value.__ctx) {\n                        //copy over defs\n                        while(value.__ctx.__defs.childNodes.length) {\n                            id = value.__ctx.__defs.childNodes[0].getAttribute(\"id\");\n                            this.__ids[id] = id;\n                            this.__defs.appendChild(value.__ctx.__defs.childNodes[0]);\n                        }\n                    }\n                    this.__currentElement.setAttribute(\"fill\", format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\n                }\n                else if(style.apply.indexOf(\"fill\")!==-1 && value instanceof CanvasGradient) {\n                    //gradient\n                    this.__currentElement.setAttribute(\"fill\", format(\"url(#{id})\", {id:value.__root.getAttribute(\"id\")}));\n                } else if(style.apply.indexOf(type)!==-1 && style.svg !== value) {\n                    if((style.svgAttr === \"stroke\" || style.svgAttr === \"fill\") && value.indexOf(\"rgba\") !== -1) {\n                        //separate alpha value, since illustrator can't handle it\n                        regex = /rgba\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d?\\.?\\d*)\\s*\\)/gi;\n                        matches = regex.exec(value);\n                        this.__currentElement.setAttribute(style.svgAttr, format(\"rgb({r},{g},{b})\", {r:matches[1], g:matches[2], b:matches[3]}));\n                        this.__currentElement.setAttribute(style.svgAttr+\"-opacity\", matches[4]);\n                    } else {\n                        //otherwise only update attribute if right type, and not svg default\n                        this.__currentElement.setAttribute(style.svgAttr, value);\n                    }\n                }\n            }\n        }\n\n    };\n\n    /**\n     * Will return the closest group or svg node. May return the current element.\n     * @private\n     */\n    ctx.prototype.__closestGroupOrSvg = function(node) {\n        node = node || this.__currentElement;\n        if(node.nodeName === \"g\" || node.nodeName === \"svg\") {\n            return node;\n        } else {\n            return this.__closestGroupOrSvg(node.parentNode);\n        }\n    };\n\n    /**\n     * Returns the serialized value of the svg so far\n     * @param fixNamedEntities - Standalone SVG doesn't support named entities, which document.createTextNode encodes.\n     *                           If true, we attempt to find all named entities and encode it as a numeric entity.\n     * @return serialized svg\n     */\n    ctx.prototype.getSerializedSvg = function(fixNamedEntities) {\n        var serialized = new XMLSerializer().serializeToString(this.__root),\n            keys, i, key, value, regexp, xmlns;\n\n        //IE search for a duplicate xmnls because they didn't implement setAttributeNS correctly\n        xmlns = /xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg\".+xmlns=\"http:\\/\\/www\\.w3\\.org\\/2000\\/svg/gi;\n        if(xmlns.test(serialized)) {\n            serialized = serialized.replace('xmlns=\"http://www.w3.org/2000/svg','xmlns:xlink=\"http://www.w3.org/1999/xlink');\n        }\n\n        if(fixNamedEntities) {\n            keys = Object.keys(namedEntities);\n            //loop over each named entity and replace with the proper equivalent.\n            for(i=0; i<keys.length; i++) {\n                key = keys[i];\n                value = namedEntities[key];\n                regexp = new RegExp(key, \"gi\");\n                if(regexp.test(serialized)) {\n                    serialized = serialized.replace(regexp, value);\n                }\n            }\n        }\n\n        return serialized;\n    };\n\n\n    /**\n     * Returns the root svg\n     * @return\n     */\n    ctx.prototype.getSvg = function() {\n        return this.__root;\n    };\n    /**\n     * Will generate a group tag.\n     */\n    ctx.prototype.save = function() {\n        var group = this.__createElement(\"g\"), parent = this.__closestGroupOrSvg();\n        this.__groupStack.push(parent);\n        parent.appendChild(group);\n        this.__currentElement = group;\n        this.__stack.push(this.__getStyleState());\n    };\n    /**\n     * Sets current element to parent, or just root if already root\n     */\n    ctx.prototype.restore = function(){\n        this.__currentElement = this.__groupStack.pop();\n        var state = this.__stack.pop();\n        this.__applyStyleState(state);\n\n    };\n\n    /**\n     * Helper method to add transform\n     * @private\n     */\n    ctx.prototype.__addTransform = function(t) {\n\n        //if the current element has siblings, add another group\n        var parent = this.__closestGroupOrSvg();\n        if(parent.childNodes.length > 0) {\n            var group = this.__createElement(\"g\");\n            parent.appendChild(group);\n            this.__currentElement = group;\n        }\n\n        var transform = this.__currentElement.getAttribute(\"transform\");\n        if(transform) {\n            transform += \" \";\n        } else {\n            transform = \"\";\n        }\n        transform += t;\n        this.__currentElement.setAttribute(\"transform\", transform);\n    };\n\n    /**\n     *  scales the current element\n     */\n    ctx.prototype.scale = function(x, y) {\n        if(y === undefined) {\n            y = x;\n        }\n        this.__addTransform(format(\"scale({x},{y})\", {x:x, y:y}));\n    };\n\n    /**\n     * rotates the current element\n     */\n    ctx.prototype.rotate = function(angle){\n        var degrees = (angle * 180 / Math.PI);\n        this.__addTransform(format(\"rotate({angle},{cx},{cy})\", {angle:degrees, cx:0, cy:0}));\n    };\n\n    /**\n     * translates the current element\n     */\n    ctx.prototype.translate = function(x, y){\n        this.__addTransform(format(\"translate({x},{y})\", {x:x,y:y}));\n    };\n\n    /**\n     * applies a transform to the current element\n     */\n    ctx.prototype.transform = function(a, b, c, d, e, f){\n        this.__addTransform(format(\"matrix({a},{b},{c},{d},{e},{f})\", {a:a, b:b, c:c, d:d, e:e, f:f}));\n    };\n\n    /**\n     * Create a new Path Element\n     */\n    ctx.prototype.beginPath = function(){\n        var path, parent;\n\n        // Note that there is only one current default path, it is not part of the drawing state.\n        // See also: https://html.spec.whatwg.org/multipage/scripting.html#current-default-path\n        this.__currentDefaultPath = \"\";\n        this.__currentPosition = {};\n\n        path = this.__createElement(\"path\", {}, true);\n        parent = this.__closestGroupOrSvg();\n        parent.appendChild(path);\n        this.__currentElement = path;\n    };\n\n    /**\n     * Helper function to apply currentDefaultPath to current path element\n     * @private\n     */\n    ctx.prototype.__applyCurrentDefaultPath = function() {\n        if(this.__currentElement.nodeName === \"path\") {\n            var d = this.__currentDefaultPath;\n            this.__currentElement.setAttribute(\"d\", d);\n        } else {\n            throw new Error(\"Attempted to apply path command to node \" + this.__currentElement.nodeName);\n        }\n    };\n\n    /**\n     * Helper function to add path command\n     * @private\n     */\n    ctx.prototype.__addPathCommand = function(command){\n        this.__currentDefaultPath += \" \";\n        this.__currentDefaultPath += command;\n    };\n\n    /**\n     * Adds the move command to the current path element,\n     * if the currentPathElement is not empty create a new path element\n     */\n    ctx.prototype.moveTo = function(x,y){\n        if(this.__currentElement.nodeName !== \"path\") {\n            this.beginPath();\n        }\n\n        // creates a new subpath with the given point\n        this.__currentPosition = {x: x, y: y};\n        this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\n    };\n\n    /**\n     * Closes the current path\n     */\n    ctx.prototype.closePath = function(){\n        this.__addPathCommand(\"Z\");\n    };\n\n    /**\n     * Adds a line to command\n     */\n    ctx.prototype.lineTo = function(x, y){\n        this.__currentPosition = {x: x, y: y};\n        if (this.__currentDefaultPath.indexOf('M') > -1) {\n            this.__addPathCommand(format(\"L {x} {y}\", {x:x, y:y}));\n        } else {\n            this.__addPathCommand(format(\"M {x} {y}\", {x:x, y:y}));\n        }\n    };\n\n    /**\n     * Add a bezier command\n     */\n    ctx.prototype.bezierCurveTo = function(cp1x, cp1y, cp2x, cp2y, x, y) {\n        this.__currentPosition = {x: x, y: y};\n        this.__addPathCommand(format(\"C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}\",\n            {cp1x:cp1x, cp1y:cp1y, cp2x:cp2x, cp2y:cp2y, x:x, y:y}));\n    };\n\n    /**\n     * Adds a quadratic curve to command\n     */\n    ctx.prototype.quadraticCurveTo = function(cpx, cpy, x, y){\n        this.__currentPosition = {x: x, y: y};\n        this.__addPathCommand(format(\"Q {cpx} {cpy} {x} {y}\", {cpx:cpx, cpy:cpy, x:x, y:y}));\n    };\n\n\n    /**\n     * Return a new normalized vector of given vector\n     */\n    var normalize = function(vector) {\n        var len = Math.sqrt(vector[0] * vector[0] + vector[1] * vector[1]);\n        return [vector[0] / len, vector[1] / len];\n    };\n\n    /**\n     * Adds the arcTo to the current path\n     *\n     * @see http://www.w3.org/TR/2015/WD-2dcontext-20150514/#dom-context-2d-arcto\n     */\n    ctx.prototype.arcTo = function(x1, y1, x2, y2, radius) {\n        // Let the point (x0, y0) be the last point in the subpath.\n        var x0 = this.__currentPosition && this.__currentPosition.x;\n        var y0 = this.__currentPosition && this.__currentPosition.y;\n\n        // First ensure there is a subpath for (x1, y1).\n        if (typeof x0 == \"undefined\" || typeof y0 == \"undefined\") {\n            return;\n        }\n\n        // Negative values for radius must cause the implementation to throw an IndexSizeError exception.\n        if (radius < 0) {\n            throw new Error(\"IndexSizeError: The radius provided (\" + radius + \") is negative.\");\n        }\n\n        // If the point (x0, y0) is equal to the point (x1, y1),\n        // or if the point (x1, y1) is equal to the point (x2, y2),\n        // or if the radius radius is zero,\n        // then the method must add the point (x1, y1) to the subpath,\n        // and connect that point to the previous point (x0, y0) by a straight line.\n        if (((x0 === x1) && (y0 === y1))\n            || ((x1 === x2) && (y1 === y2))\n            || (radius === 0)) {\n            this.lineTo(x1, y1);\n            return;\n        }\n\n        // Otherwise, if the points (x0, y0), (x1, y1), and (x2, y2) all lie on a single straight line,\n        // then the method must add the point (x1, y1) to the subpath,\n        // and connect that point to the previous point (x0, y0) by a straight line.\n        var unit_vec_p1_p0 = normalize([x0 - x1, y0 - y1]);\n        var unit_vec_p1_p2 = normalize([x2 - x1, y2 - y1]);\n        if (unit_vec_p1_p0[0] * unit_vec_p1_p2[1] === unit_vec_p1_p0[1] * unit_vec_p1_p2[0]) {\n            this.lineTo(x1, y1);\n            return;\n        }\n\n        // Otherwise, let The Arc be the shortest arc given by circumference of the circle that has radius radius,\n        // and that has one point tangent to the half-infinite line that crosses the point (x0, y0) and ends at the point (x1, y1),\n        // and that has a different point tangent to the half-infinite line that ends at the point (x1, y1), and crosses the point (x2, y2).\n        // The points at which this circle touches these two lines are called the start and end tangent points respectively.\n\n        // note that both vectors are unit vectors, so the length is 1\n        var cos = (unit_vec_p1_p0[0] * unit_vec_p1_p2[0] + unit_vec_p1_p0[1] * unit_vec_p1_p2[1]);\n        var theta = Math.acos(Math.abs(cos));\n\n        // Calculate origin\n        var unit_vec_p1_origin = normalize([\n            unit_vec_p1_p0[0] + unit_vec_p1_p2[0],\n            unit_vec_p1_p0[1] + unit_vec_p1_p2[1]\n        ]);\n        var len_p1_origin = radius / Math.sin(theta / 2);\n        var x = x1 + len_p1_origin * unit_vec_p1_origin[0];\n        var y = y1 + len_p1_origin * unit_vec_p1_origin[1];\n\n        // Calculate start angle and end angle\n        // rotate 90deg clockwise (note that y axis points to its down)\n        var unit_vec_origin_start_tangent = [\n            -unit_vec_p1_p0[1],\n            unit_vec_p1_p0[0]\n        ];\n        // rotate 90deg counter clockwise (note that y axis points to its down)\n        var unit_vec_origin_end_tangent = [\n            unit_vec_p1_p2[1],\n            -unit_vec_p1_p2[0]\n        ];\n        var getAngle = function(vector) {\n            // get angle (clockwise) between vector and (1, 0)\n            var x = vector[0];\n            var y = vector[1];\n            if (y >= 0) { // note that y axis points to its down\n                return Math.acos(x);\n            } else {\n                return -Math.acos(x);\n            }\n        };\n        var startAngle = getAngle(unit_vec_origin_start_tangent);\n        var endAngle = getAngle(unit_vec_origin_end_tangent);\n\n        // Connect the point (x0, y0) to the start tangent point by a straight line\n        this.lineTo(x + unit_vec_origin_start_tangent[0] * radius,\n                    y + unit_vec_origin_start_tangent[1] * radius);\n\n        // Connect the start tangent point to the end tangent point by arc\n        // and adding the end tangent point to the subpath.\n        this.arc(x, y, radius, startAngle, endAngle);\n    };\n\n    /**\n     * Sets the stroke property on the current element\n     */\n    ctx.prototype.stroke = function(){\n        if(this.__currentElement.nodeName === \"path\") {\n            this.__currentElement.setAttribute(\"paint-order\", \"fill stroke markers\");\n        }\n        this.__applyCurrentDefaultPath();\n        this.__applyStyleToCurrentElement(\"stroke\");\n    };\n\n    /**\n     * Sets fill properties on the current element\n     */\n    ctx.prototype.fill = function(){\n        if(this.__currentElement.nodeName === \"path\") {\n            this.__currentElement.setAttribute(\"paint-order\", \"stroke fill markers\");\n        }\n        this.__applyCurrentDefaultPath();\n        this.__applyStyleToCurrentElement(\"fill\");\n    };\n\n    /**\n     *  Adds a rectangle to the path.\n     */\n    ctx.prototype.rect = function(x, y, width, height){\n        if(this.__currentElement.nodeName !== \"path\") {\n            this.beginPath();\n        }\n        this.moveTo(x, y);\n        this.lineTo(x+width, y);\n        this.lineTo(x+width, y+height);\n        this.lineTo(x, y+height);\n        this.lineTo(x, y);\n        this.closePath();\n    };\n\n\n    /**\n     * adds a rectangle element\n     */\n    ctx.prototype.fillRect = function(x, y, width, height){\n        var rect, parent;\n        rect = this.__createElement(\"rect\", {\n            x : x,\n            y : y,\n            width : width,\n            height : height\n        }, true);\n        parent = this.__closestGroupOrSvg();\n        parent.appendChild(rect);\n        this.__currentElement = rect;\n        this.__applyStyleToCurrentElement(\"fill\");\n    };\n\n    /**\n     * Draws a rectangle with no fill\n     * @param x\n     * @param y\n     * @param width\n     * @param height\n     */\n    ctx.prototype.strokeRect = function(x, y, width, height){\n        var rect, parent;\n        rect = this.__createElement(\"rect\", {\n            x : x,\n            y : y,\n            width : width,\n            height : height\n        }, true);\n        parent = this.__closestGroupOrSvg();\n        parent.appendChild(rect);\n        this.__currentElement = rect;\n        this.__applyStyleToCurrentElement(\"stroke\");\n    };\n\n\n    /**\n     * \"Clears\" a canvas by just drawing a white rectangle in the current group.\n     */\n    ctx.prototype.clearRect = function(x, y, width, height) {\n        var rect, parent = this.__closestGroupOrSvg();\n        rect = this.__createElement(\"rect\", {\n            x : x,\n            y : y,\n            width : width,\n            height : height,\n            fill : \"#FFFFFF\"\n        }, true);\n        parent.appendChild(rect);\n    };\n\n    /**\n     * Adds a linear gradient to a defs tag.\n     * Returns a canvas gradient object that has a reference to it's parent def\n     */\n    ctx.prototype.createLinearGradient = function(x1, y1, x2, y2){\n        var grad = this.__createElement(\"linearGradient\", {\n            id : randomString(this.__ids),\n            x1 : x1+\"px\",\n            x2 : x2+\"px\",\n            y1 : y1+\"px\",\n            y2 : y2+\"px\",\n            \"gradientUnits\" : \"userSpaceOnUse\"\n        }, false);\n        this.__defs.appendChild(grad);\n        return new CanvasGradient(grad, this);\n    };\n\n    /**\n     * Adds a radial gradient to a defs tag.\n     * Returns a canvas gradient object that has a reference to it's parent def\n     */\n    ctx.prototype.createRadialGradient = function(x0, y0, r0, x1, y1, r1){\n        var grad = this.__createElement(\"radialGradient\", {\n            id : randomString(this.__ids),\n            cx : x1+\"px\",\n            cy : y1+\"px\",\n            r  : r1+\"px\",\n            fx : x0+\"px\",\n            fy : y0+\"px\",\n            \"gradientUnits\" : \"userSpaceOnUse\"\n        }, false);\n        this.__defs.appendChild(grad);\n        return new CanvasGradient(grad, this);\n\n    };\n\n    /**\n     * Parses the font string and returns svg mapping\n     * @private\n     */\n    ctx.prototype.__parseFont = function() {\n        var regex = /^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))(?:\\s*\\/\\s*(normal|[.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])))?\\s*([-,\\\"\\sa-z]+?)\\s*$/i;\n        var fontPart = regex.exec( this.font );\n        var data = {\n            style : fontPart[1] || 'normal',\n            size : fontPart[4] || '10px',\n            family : fontPart[6] || 'sans-serif',\n            weight: fontPart[3] || 'normal',\n            decoration : fontPart[2] || 'normal',\n            href : null\n        };\n\n        //canvas doesn't support underline natively, but we can pass this attribute\n        if(this.__fontUnderline === \"underline\") {\n            data.decoration = \"underline\";\n        }\n\n        //canvas also doesn't support linking, but we can pass this as well\n        if(this.__fontHref) {\n            data.href = this.__fontHref;\n        }\n\n        return data;\n    };\n\n    /**\n     * Helper to link text fragments\n     * @param font\n     * @param element\n     * @return {*}\n     * @private\n     */\n    ctx.prototype.__wrapTextLink = function(font, element) {\n        if(font.href) {\n            var a = this.__createElement(\"a\");\n            a.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\", font.href);\n            a.appendChild(element);\n            return a;\n        }\n        return element;\n    };\n\n    /**\n     * Fills or strokes text\n     * @param text\n     * @param x\n     * @param y\n     * @param action - stroke or fill\n     * @private\n     */\n    ctx.prototype.__applyText = function(text, x, y, action) {\n        var font = this.__parseFont(),\n            parent = this.__closestGroupOrSvg(),\n            textElement = this.__createElement(\"text\", {\n                \"font-family\" : font.family,\n                \"font-size\" : font.size,\n                \"font-style\" : font.style,\n                \"font-weight\" : font.weight,\n                \"text-decoration\" : font.decoration,\n                \"x\" : x,\n                \"y\" : y,\n                \"text-anchor\": getTextAnchor(this.textAlign),\n                \"dominant-baseline\": getDominantBaseline(this.textBaseline)\n            }, true);\n\n        textElement.appendChild(this.__document.createTextNode(text));\n        this.__currentElement = textElement;\n        this.__applyStyleToCurrentElement(action);\n        parent.appendChild(this.__wrapTextLink(font,textElement));\n    };\n\n    /**\n     * Creates a text element\n     * @param text\n     * @param x\n     * @param y\n     */\n    ctx.prototype.fillText = function(text, x, y){\n        this.__applyText(text, x, y, \"fill\");\n    };\n\n    /**\n     * Strokes text\n     * @param text\n     * @param x\n     * @param y\n     */\n    ctx.prototype.strokeText = function(text, x, y){\n        this.__applyText(text, x, y, \"stroke\");\n    };\n\n    /**\n     * No need to implement this for svg.\n     * @param text\n     * @return {TextMetrics}\n     */\n    ctx.prototype.measureText = function(text){\n        this.__ctx.font = this.font;\n        return this.__ctx.measureText(text);\n    };\n\n    /**\n     *  Arc command!\n     */\n    ctx.prototype.arc = function(x, y, radius, startAngle, endAngle, counterClockwise) {\n        // in canvas no circle is drawn if no angle is provided.\n        if (startAngle === endAngle) {\n            return;\n        }\n        startAngle = startAngle % (2*Math.PI);\n        endAngle = endAngle % (2*Math.PI);\n        if(startAngle === endAngle) {\n            //circle time! subtract some of the angle so svg is happy (svg elliptical arc can't draw a full circle)\n            endAngle = ((endAngle + (2*Math.PI)) - 0.001 * (counterClockwise ? -1 : 1)) % (2*Math.PI);\n        }\n        var endX = x+radius*Math.cos(endAngle),\n            endY = y+radius*Math.sin(endAngle),\n            startX = x+radius*Math.cos(startAngle),\n            startY = y+radius*Math.sin(startAngle),\n            sweepFlag = counterClockwise ? 0 : 1,\n            largeArcFlag = 0,\n            diff = endAngle - startAngle;\n\n        // https://github.com/gliffy/canvas2svg/issues/4\n        if(diff < 0) {\n            diff += 2*Math.PI;\n        }\n\n        if(counterClockwise) {\n            largeArcFlag = diff > Math.PI ? 0 : 1;\n        } else {\n            largeArcFlag = diff > Math.PI ? 1 : 0;\n        }\n\n        this.lineTo(startX, startY);\n        this.__addPathCommand(format(\"A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}\",\n            {rx:radius, ry:radius, xAxisRotation:0, largeArcFlag:largeArcFlag, sweepFlag:sweepFlag, endX:endX, endY:endY}));\n\n        this.__currentPosition = {x: endX, y: endY};\n    };\n\n    /**\n     * Generates a ClipPath from the clip command.\n     */\n    ctx.prototype.clip = function(){\n        var group = this.__closestGroupOrSvg(),\n            clipPath = this.__createElement(\"clipPath\"),\n            id =  randomString(this.__ids),\n            newGroup = this.__createElement(\"g\");\n\n        group.removeChild(this.__currentElement);\n        clipPath.setAttribute(\"id\", id);\n        clipPath.appendChild(this.__currentElement);\n\n        this.__defs.appendChild(clipPath);\n\n        //set the clip path to this group\n        group.setAttribute(\"clip-path\", format(\"url(#{id})\", {id:id}));\n\n        //clip paths can be scaled and transformed, we need to add another wrapper group to avoid later transformations\n        // to this path\n        group.appendChild(newGroup);\n\n        this.__currentElement = newGroup;\n\n    };\n\n    /**\n     * Draws a canvas, image or mock context to this canvas.\n     * Note that all svg dom manipulation uses node.childNodes rather than node.children for IE support.\n     * http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-drawimage\n     */\n    ctx.prototype.drawImage = function(){\n        //convert arguments to a real array\n        var args = Array.prototype.slice.call(arguments),\n            image=args[0],\n            dx, dy, dw, dh, sx=0, sy=0, sw, sh, parent, svg, defs, group,\n            currentElement, svgImage, canvas, context, id;\n\n        if(args.length === 3) {\n            dx = args[1];\n            dy = args[2];\n            sw = image.width;\n            sh = image.height;\n            dw = sw;\n            dh = sh;\n        } else if(args.length === 5) {\n            dx = args[1];\n            dy = args[2];\n            dw = args[3];\n            dh = args[4];\n            sw = image.width;\n            sh = image.height;\n        } else if(args.length === 9) {\n            sx = args[1];\n            sy = args[2];\n            sw = args[3];\n            sh = args[4];\n            dx = args[5];\n            dy = args[6];\n            dw = args[7];\n            dh = args[8];\n        } else {\n            throw new Error(\"Inavlid number of arguments passed to drawImage: \" + arguments.length);\n        }\n\n        parent = this.__closestGroupOrSvg();\n        currentElement = this.__currentElement;\n\n        if(image instanceof ctx) {\n            //canvas2svg mock canvas context. In the future we may want to clone nodes instead.\n            //also I'm currently ignoring dw, dh, sw, sh, sx, sy for a mock context.\n            svg = image.getSvg();\n            defs = svg.childNodes[0];\n            while(defs.childNodes.length) {\n                id = defs.childNodes[0].getAttribute(\"id\");\n                this.__ids[id] = id;\n                this.__defs.appendChild(defs.childNodes[0]);\n            }\n            group = svg.childNodes[1];\n            parent.appendChild(group);\n            this.__currentElement = group;\n            this.translate(dx, dy);\n            this.__currentElement = currentElement;\n        } else if(image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\n            //canvas or image\n            svgImage = this.__createElement(\"image\");\n            svgImage.setAttribute(\"width\", dw);\n            svgImage.setAttribute(\"height\", dh);\n            svgImage.setAttribute(\"preserveAspectRatio\", \"none\");\n\n            if(sx || sy || sw !== image.width || sh !== image.height) {\n                //crop the image using a temporary canvas\n                canvas = this.__document.createElement(\"canvas\");\n                canvas.width = dw;\n                canvas.height = dh;\n                context = canvas.getContext(\"2d\");\n                context.drawImage(image, sx, sy, sw, sh, 0, 0, dw, dh);\n                image = canvas;\n            }\n\n            svgImage.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\n                image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\n            parent.appendChild(svgImage);\n            this.__currentElement = svgImage;\n            this.translate(dx, dy);\n            this.__currentElement = currentElement;\n        }\n    };\n\n    /**\n     * Generates a pattern tag\n     */\n    ctx.prototype.createPattern = function(image, repetition){\n        var pattern = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"pattern\"), id = randomString(this.__ids),\n            img;\n        pattern.setAttribute(\"id\", id);\n        pattern.setAttribute(\"width\", image.width);\n        pattern.setAttribute(\"height\", image.height);\n        if(image.nodeName === \"CANVAS\" || image.nodeName === \"IMG\") {\n            img = this.__document.createElementNS(\"http://www.w3.org/2000/svg\", \"image\");\n            img.setAttribute(\"width\", image.width);\n            img.setAttribute(\"height\", image.height);\n            img.setAttributeNS(\"http://www.w3.org/1999/xlink\", \"xlink:href\",\n                image.nodeName === \"CANVAS\" ? image.toDataURL() : image.getAttribute(\"src\"));\n            pattern.appendChild(img);\n            this.__defs.appendChild(pattern);\n        } else if(image instanceof ctx) {\n            pattern.appendChild(image.__root.childNodes[1]);\n            this.__defs.appendChild(pattern);\n        }\n        return new CanvasPattern(pattern, this);\n    };\n\n    /**\n     * Not yet implemented\n     */\n    ctx.prototype.drawFocusRing = function(){};\n    ctx.prototype.createImageData = function(){};\n    ctx.prototype.getImageData = function(){};\n    ctx.prototype.putImageData = function(){};\n    ctx.prototype.globalCompositeOperation = function(){};\n    ctx.prototype.setTransform = function(){};\n\n    //add options for alternative namespace\n    if (typeof window === \"object\") {\n        window.C2S = ctx;\n    }\n\n    // CommonJS/Browserify\n    if (typeof module === \"object\" && typeof module.exports === \"object\") {\n        module.exports = ctx;\n    }\n\n}());\n","import C2S from 'canvas2svg';\n\nfunction exportSVG(tree, method, args = []) {\n  // save a copy of the tree original drawing context\n  const originalCxt = tree.ctx;\n\n  // replace the tree drawing context with the SVG drawing context\n  const { width, height } = originalCxt.canvas;\n  const svgCtx = new C2S(width, height);\n  tree.ctx = svgCtx;\n\n  // draw the tree on the SVG drawing context\n  tree.render();\n\n  // get the SVG element\n  const svg = svgCtx[method].apply(svgCtx, args);\n\n  // restore the tree original drawing context\n  tree.ctx = originalCxt;\n  tree.render();\n\n  return svg;\n}\n\nexport default function (tree) {\n  tree.exportSVG = () => exportSVG(tree, 'getSvg');\n  tree.exportSerialisedSVG = (fixNamedEntities = false) =>\n    exportSVG(tree, 'getSerializedSvg', [ fixNamedEntities ]);\n}\n"],"sourceRoot":""}